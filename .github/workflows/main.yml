# .github/workflows/main.yml

name: Scrape Naver News

on:
  # ë§¤ì‹œ ì •ê°ì— ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰ (UTC ê¸°ì¤€)
  # í•œêµ­ ì‹œê°„(KST)ì€ UTC+9 ì´ë¯€ë¡œ, 00:00 UTCëŠ” 09:00 KST ì…ë‹ˆë‹¤.
  # ë§¤ì‹œê°„ ì‹¤í–‰ë˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.
  schedule:
    - cron: '0 * * * *'
  # ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ workflow_dispatch ì¶”ê°€
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1. ì €ì¥ì†Œì˜ ì½”ë“œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. Python í™˜ê²½ì„ ì„¤ì •í•©ë‹ˆë‹¤.
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12.4' # ì›í•˜ëŠ” íŒŒì´ì¬ ë²„ì „

      # 3. í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          
      # Playwright ì„¤ì¹˜
      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      - name: Install Playwright browsers
        run: |
          playwright install

      # 4. Python ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
      - name: Run Python script
        env:
          # ğŸ‘‡ ì—¬ê¸°ì— ì‹œê°„ëŒ€ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
          TZ: 'Asia/Seoul' 
          # GitHub Secretsì— ì €ì¥í•œ ê°’ì„ í™˜ê²½ ë³€ìˆ˜ë¡œ ìŠ¤í¬ë¦½íŠ¸ì— ì „ë‹¬í•©ë‹ˆë‹¤.
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          python naver_news_telegram_bot_v2.py

      # 5. ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í›„ ìƒì„±ëœ news_data.json íŒŒì¼ì„ ì»¤ë°‹í•˜ê³  í‘¸ì‹œí•©ë‹ˆë‹¤.    
      - name: Commit and push news_data.json
        env:
            GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git remote set-url origin https://x-access-token:${GH_TOKEN}@github.com/devfallo/NewsNaverSendTelegram.git
          git add news_data.json
          git commit -m "Add news_data.json"
          git push

